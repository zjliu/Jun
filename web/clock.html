<html>
<head>
<title>load</title>
<style>
	*{margin:0px;padding:0px;}
	body{background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADUAAAATCAIAAAHIduKaAAAACXBIWXMAAAsTAAALEwEAmpwYAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAABh0lEQVR42mL8f82A4f8fKGKTY2D4y/D/L0AAMTFgAwABhF0UIIAY/1/VA+ll+MPAKgvRzsDwDyCAsKsFCCCsov8BAogR7IZ/QF1QEsJgkwfKgbn/weJA9n+AAMJuLFYAEEBAd+kjDIOQ7PIM/9GM/AcQQMQaCRBAxKoDCCBi1QEEEC51/9H4AAEECZ3/EP9DEVYuuwKYwYAkxQCTRREECCASAhE3QHEmQABRxUQUABBAVDfxP0AAMVHgwf9YVQAEECSFYQY2aswAowUhjho5/1H0AgQQlb0MEEBM+JMVqQAggDBc958iEwECiIl6iQ8EAAKIiShVRMcvQAARmzeJBAABxERJKsMEAAHERFrYEAIAAcREamDjVwoQQPDyigEpxSMb8x8p9eAg4bLsiqgiGOYwYIj/J6AAIICoHHpUS8IwABBATAyDGwAEEBHu+/9/AN0HEEBMlEcB+XqJMBIggJiolVBoBAACiImqyfk/1X0LEEBMtMh01Avs/wABxESzkoE6egACDADspa2gmkp4hgAAAABJRU5ErkJggg==);}
	.mainDiv{position:absolute;left:0;right:0;top:0;bottom:0;}
	.mainDiv .centerDiv{position:absolute;left:128px;top:64px;right:128px;bottom:100px;overflow:auto;}
	table.allTb{width:100%;height:100%;}
	.clock{
		width:300px;
		height:300px;
		border:solid rgba(0,0,0,0) 1px;
		border-radius:150px;
		box-shadow:rgba(0,0,0,.8) 0 0 8px;
		position:relative;
	}
	.clock .bgCanvas{
		background-color:rgba(0,0,0,0);	
		position:absolute;
		top:0;
		left:0;
	}
	.clock .pointer{
		position:absolute;
	}
	.clock .center{
		width:10px;
		height:10px;
		background-color:yellow;
		border-radius:5px;
		position:absolute;
		top:147px;
		left:147px;
		z-index:5;
	}
	.pointer span{
		display:block;
		width:0px;
		height:0px;
		border:15px solid rgba(0,0,0,0);
		border-width:15px 0px 15px 25px;
	}
	.clock .s-pointer .p_head{
		border-width:0px 10px 145px 10px;
		border-bottom-color:red;
	}
	.clock .s-pointer .p_tail{
		border-width:45px 10px 0px 10px;
		border-top-color:red;
	}
	.clock .m-pointer .p_head{
		border-width:0px 8px 135px 8px;
		border-bottom-color:green;
	}
	.clock .m-pointer .p_tail{
		border-width:35px 8px 0px 8px;
		border-top-color:green;
	}
	.clock .h-pointer .p_head{
		border-width:0px 6px 125px 6px;
		border-bottom-color:blue;
	}
	.clock .h-pointer .p_tail{
		border-width:25px 6px 0px 6px;
		border-top-color:blue;
	}
</style>
<style>
</style>
<script>
</script>
</head>
<body>
<div class="mainDiv">
	<div class="centerDiv">
		<table class="allTb">
			<tr>
				<td>
					<div id="clock" class="clock">
						<canvas class="bgCanvas" width="300" height="300"></canvas>
						<span class="center"></span>
						<div class="pointer s-pointer">
							<span class="p_head"></span><span class="p_tail"></span>
						</div>
						<div class="pointer m-pointer">
							<span class="p_head"></span><span class="p_tail"></span>
						</div>
						<div class="pointer h-pointer">
							<span class="p_head"></span><span class="p_tail"></span>	
						</div>
					</div>
				</td>
			</tr>
		</table>
	</div>
</div>
</body>
</html>
<script>
	var JunClock=(function(){
		var Clock=function(opts){
			for(var key in opts){
				this[key]=opts[key];
			}
			var clock = this.clock;
			this.sPointer=clock.querySelector(".s-pointer");
			this.mPointer=clock.querySelector(".m-pointer");
			this.hPointer=clock.querySelector(".h-pointer");

			this.sTail= this.sPointer.querySelector(".p_tail");
			this.sHead= this.sPointer.querySelector(".p_head");
			this.mTail= this.mPointer.querySelector(".p_tail");
			this.mHead= this.mPointer.querySelector(".p_head");
			this.hTail= this.hPointer.querySelector(".p_tail");
			this.hHead= this.hPointer.querySelector(".p_head");
			this.centerPointEl = clock.querySelector(".center");

			this.bgCanvas = this.clock.querySelector(".bgCanvas");

			this.centerPointR = parseInt(getComputedStyle(this.centerPointEl)["width"]) / 2;
			this.R= parseInt(getComputedStyle(this.clock)["width"]) / 2;
		}
		Clock.prototype={
			init:function(){
				//添加刻度背景
				var canvas = this.bgCanvas,
					context = canvas.getContext("2d");
				context.translate(this.R,this.R);	
				var fontSize = 20;
				context.font="bold "+fontSize +"px Arial";
				for(var i=1;i<=12;i++){
					var angle = (i/6-0.5)*Math.PI;
					var x = Math.cos(angle)*(this.R-10);
					var y = Math.sin(angle)*(this.R-10);
					var rx = Math.cos(angle)*this.R;
					var ry = Math.sin(angle)*this.R;
					var text=i.toString();
					var tLength = context.measureText(text).width;

					var grd = context.createRadialGradient(0,0,50,0,0,tLength/2);
					grd.addColorStop(0,"green");
					grd.addColorStop(1,"red");
					context.fillStyle=grd;
					context.fillText(i,x-tLength/2,y+fontSize/3);

					context.arc(0,0,50,0,Math.PI*2);
					context.fill();
				}

				//设置圆心位置
				this.centerPointEl.style.top=this.R-this.centerPointR;	
				this.centerPointEl.style.left=this.R-this.centerPointR;

				//设置钞针旋转位置
				this.sPointer.style.webkitTransformOrigin=this.getTransformOrigin(this.sTail,this.sHead);
				//设置分针旋转位置
				this.mPointer.style.webkitTransformOrigin=this.getTransformOrigin(this.mTail,this.mHead);
				//设置时针旋转位置
				this.hPointer.style.webkitTransformOrigin=this.getTransformOrigin(this.hTail,this.hHead);
				
				//设置针位置
				var sPosition = this.getPointerPosition(this.sTail,this.sHead);
				var mPosition = this.getPointerPosition(this.mTail,this.mHead);
				var hPosition = this.getPointerPosition(this.hTail,this.hHead);

				this.sPointer.style.top=sPosition.top +"px";
				this.sPointer.style.left=sPosition.left +"px";
				this.mPointer.style.top=mPosition.top +"px";
				this.mPointer.style.left=mPosition.left +"px";
				this.hPointer.style.top=hPosition.top +"px";
				this.hPointer.style.left=hPosition.left +"px";
				this.run();
			},
			run:function(){
				var self=this;
				setInterval(function(){
					var date = new Date();
					var h = date.getHours();
					var m = date.getMinutes();
					var s = date.getSeconds();
					
					var realHour = h + (m/60) + (s/360);
					var hourAngle = realHour * 30;
					var realMinute = m + s/60;
					var minuteAngle = realMinute * 6;
					var secondAngle = s * 6;
					
					self.sPointer.style.webkitTransform="rotateZ("+secondAngle+"deg)";
					self.mPointer.style.webkitTransform="rotateZ("+minuteAngle+"deg)";
					self.hPointer.style.webkitTransform="rotateZ("+hourAngle+"deg)";

				},1000);
			},
			getTransformOrigin:function(tail,head){
				var headWidth = this.getStyle(head,"borderBottomWidth",true);
				var tailTopWidth = this.getStyle(tail,"borderTopWidth",true);
				return "50% " + 100*headWidth/(tailTopWidth+headWidth)+"%";
			},
			getPointerPosition:function(tail,head){
				var headWidth = this.getStyle(head,"borderBottomWidth",true);
				var tailLeftWidth = this.getStyle(tail,"borderLeftWidth",true);
				return {"top":this.R-headWidth,"left":this.R-tailLeftWidth};
			},
			getStyle:function(el,name,needInt){
				var value = getComputedStyle(el)[name];
				return needInt?parseInt(value):value;
			}
		}
		return Clock;
	})();

	var clockEl = document.getElementById("clock");
	var clock=new JunClock({
		"clock":clockEl
	});
	clock.init();

</script>
<script>
function ajax(o) {
	var b = /POST/i.test(o.type),
		p = o.data || '',
		t = o.dataType,
		url = o.url || location.href,
		q = /\?/.test(url) ? '&' : '?',
		x = window.XMLHttpRequest ? new XMLHttpRequest() : (new ActiveXObject('Msxml2.XMLHTTP') || new ActiveXObject('Microsoft.XMLHTTP')),
		z = function (s) {
			if (x.readyState == 4) {
				if (x.status == 200) {
					s = x.responseText;
					if (t == 'json')
						s = json(s);
					if (b = o.success)
						b(s)
				} else if (o.error) {
					o.error(x.status, x)
				}
			}
		};
	x.onreadystatechange = z;
	if (typeof p == 'object') {
		var r = [];
		for (var k in p)
			r.push(encodeURIComponent(k) + '=' + encodeURIComponent(p[k]));
		p = r.join('&')
	}
	x.open(b ? 'POST' : 'GET', url + (b ? '' : ((p ? q : '') + p + (o.cache ? '' : (((!p && q == '?') ? '?' : '&') + '_=' + new Date().getTime())))),
			o.async === false ? false : true);
	if (b) x.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	x.send(p);
	return x;
}
</script>
