<!DOCTYPE HTML>
<html>
<head>
<title>相册</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="format-detection" content="telephone=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<script type="text/javascript">
	var phoneWidth =  parseInt(window.screen.width);
	var phoneScale = phoneWidth/640;
	var ua = navigator.userAgent;
	if (/Android (\d+\.\d+)/.test(ua)){
		var version = parseFloat(RegExp.$1);
		if(version>2.3){
			document.write('<meta name="viewport" content="width=640, minimum-scale = '+phoneScale+', maximum-scale = '+phoneScale+', target-densitydpi=device-dpi">');
		}else{
			document.write('<meta name="viewport" content="width=640, target-densitydpi=device-dpi">');
		}
	} else {
		document.write('<meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi">');
	}
</script>
<meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi">
<!--移动端版本兼容 end -->
<script>SYS_SITE_ID = 136</script>
<style type="text/css">
html { width: 100%; height: 100%; }
body { margin:0 auto; width:400px; background:#fff; font-family:"微软雅黑";z-index:1;position:relative;}
*{ padding:0; margin:0;}
a{ text-decoration:none;}
.win{ 
	width:100%;
	position:relative; cursor:pointer;
	-webkit-perspective: 2000px;
	-moz-perspective: 2000px;
	perspective: 2000px;
	-webkit-transform-style: preserve-3d;
	-moz-transform-style: preserve-3d;
	transform-style: preserve-3d;
	-webkit-transform:rotateX(0deg);
	-moz-transform:rotateX(0deg);
}
.pscroll{
	width:100%;
	height:100%;
	position:absolute;
	left:0;
	top:0%;
	-webkit-transform-style: preserve-3d;
	-moz-transform-style: preserve-3d;
	transform-style: preserve-3d;
	-webkit-transition: all 1s;
	-moz-transition: all 1s;
	transition: all 1s;
	text-align:center;
	color:#396;
}
section{display:block;}
/* 声音提示 */
.audio_txt { position:fixed; top:59px; right:90px; height:60px; overflow:hidden; opacity:1;z-index:2000; 
	-webkit-transition: opacity 1s;
	-moz-transition: opacity 1s;
	-ms-transition: opacity 1s;
	-0-transition: opacity 1s;
	transition: opacity 1s;
}

/* 统一功能模块样式 fn- */
.fn-audio { position:fixed; top:45px; right:35px; z-index:2000; width:60px; height:61px; line-height:120px; text-align:center; }
.fn-audio .btn p { width:60px; height:61px; }
.fn-audio .btn p span { display:none; width: 60px; height: 61px; }
.fn-audio .btn p span:first-child { display:inline-block; }
.fn-audio .btn audio { height:0; width:0; opacity:0; }

/* 统一功能模块样式 fn- */
.fn-audio { position:fixed; top:45px; right:35px; z-index:2000; width:60px; height:61px; line-height:120px; text-align:center; }
.fn-audio .btn p { width:60px; height:61px; }
.fn-audio .btn p span { display:none; width: 60px; height: 61px; }
.fn-audio .btn p span:first-child { display:inline-block; }
.fn-audio .btn audio { height:0; width:0; opacity:0; }

/* 声音提示 */
.audio_txt { position:fixed; top:59px; right:90px; height:60px; overflow:hidden; opacity:1; z-index:2000; 
	-webkit-transition: opacity 1s;
	-moz-transition: opacity 1s;
	-ms-transition: opacity 1s;
	-0-transition: opacity 1s;
	transition: opacity 1s;
}
.audio_txt p { float:left; background:rgba(93,143,176,0.5); font-size:16px; color:#fff; font-weight:bold; }
.audio_txt p:first-child { padding:0 10px; height:40px; line-height:40px; border-bottom-left-radius:10px; border-top-left-radius:10px; }
.audio_txt p:last-child { 
	border-style: solid;
	border-width: 20px;
	border-color: transparent transparent transparent rgba(93,143,176,0.5);
	background:none;	
}
.audio_txt.close { opacity:0; }

.audio_open { background-position:-60px 0px; }
.btn_audio .audio_open{background-position-x:-60px;background-position-y:0px;}
.audio_close { background-position: 0 0; }

.css_sprite01 { background:url(/Tesla/userfiles/sprite01.png) no-repeat; background-repeat: no-repeat; }

</style>
<script src="js/jQuery-1.7.1.js"></script>
</head>
<body>
	<section class="win" id="win">
		<section class="pscroll" style="background:url(/Tesla/userfiles/001.jpg) center no-repeat;"></section>
		<section class="pscroll" style="background:url(/Tesla/userfiles/002.jpg) center no-repeat;"></section>
		<section class="pscroll" style="background:url(/Tesla/userfiles/003.jpg) center no-repeat;"></section>
		<section class="pscroll" style="background:url(/Tesla/userfiles/004.jpg) center no-repeat;"></section>
		<section class="pscroll" style="background:url(/Tesla/userfiles/005.jpg) center no-repeat;"></section>
		<section class="pscroll" style="background:url(/Tesla/userfiles/006.jpg) center no-repeat;"></section>
		<section class="pscroll" style="background:url(/Tesla/userfiles/007.jpg) center no-repeat;"></section>
		<section class="pscroll" style="background:url(/Tesla/userfiles/008.jpg) center no-repeat;">
			<img id="register" style="position:absolute;left:34%;top:54%;" width="112px" height="31px" src="/Tesla/userfiles/regbtn.png">
		</section>
	</section>
	<div class="audio_txt close">
		<p class="txt">点击开启/关闭音效</p>
		<p></p>
	</div>
	<section class="fn-audio">
	<div class="btn">
		<p class="btn_audio"><span class="css_sprite01 audio_open"></span><span class="css_sprite01 audio_close"></span></p>
		<audio id="car_audio" controls="" preload="preload">
			<source src="/Tesla/userfiles/bg.mp3" type="audio/mpeg" />
			您的浏览器不支持HTML5音频格式
		</audio>
	</div>
	</section>
</body>
</html>
<script>
	function E(f, e, o) {
		if (!e) e = 'load';
		if (!o) o = window;
		if (o.attachEvent) {
			o.attachEvent('on' + e, f)
		} else {
			o.addEventListener(e, f, false)
		}
	}
	function isMobile() {
		var isMobile = navigator.userAgent.match(/Android/i) 
			|| navigator.userAgent.match(/webOS/i) 
			|| navigator.userAgent.match(/iPhone/i) 
			|| navigator.userAgent.match(/iPad/i) 
			|| navigator.userAgent.match(/iPod/i) 
			|| navigator.userAgent.match(/BlackBerry/i) 
			|| navigator.userAgent.match(/Windows Phone/i);
		return isMobile ? true: false;
	}
	function getBroseType(){
		var dummyStyle = document.body.style;
		var vendors = 't,webkitT,MozT,msT,OT'.split(','),
		t,
		i = 0,
		l = vendors.length;
		for ( ; i < l; i++ ) {
			t = vendors[i] + 'ransform';
			if ( t in dummyStyle ) {
				var kernel = vendors[i].substr(0, vendors[i].length - 1);
				return kernel;
			}
		}
	}
	var isM = isMobile();
	var START = isM ? "touchstart": "mousedown"
	var MOVE = isM ? "touchmove": "mousemove"
	var END = isM ? "touchend": "mouseup"
	var coreType = getBroseType() || "webkit";
	var kernel = '-'+coreType+'-'; 

	function init_pageH(){
		var fn_h = function() {
			if(document.compatMode == "BackCompat")
				var Node = document.body;
			else
				var Node = document.documentElement;
			 return Math.max(Node.scrollHeight,Node.clientHeight);
		}
		var fn_w = function() {
			if(document.compatMode == "BackCompat")
				var Node = document.body;
			else
				var Node = document.documentElement;
			 return Math.max(Node.scrollWidth,Node.clientWidth);
		}
		var page_h = fn_h();
		var page_w = fn_w();
		var m_h = $(".m-page").height();
		page_h >= m_h ? v_h = page_h : v_h = m_h ;
		
		//设置各种模块页面的高度，扩展到整个屏幕高度
		$(".win,.pscroll").css({"height":v_h});
	};
	init_pageH();

	var registerUrl = "http://115.29.144.55/index.php?g=Wap&m=Selfform&a=index&token=rkzvor1394369693&wecha_id=&id=25";

$(document).ready(function(){
	$("#car_audio")[0].play();
	audio_loop = true;
	var startX = 0, startY = 0;
	var win = $("#win")[0]; 
	if(!win) return;
	_w=window.screen.width;
	_popw=480;
	_left=0;
	_top=0;
	setTimeout(function() {
		window.scrollTo(0, 1)  
	}, 0);
	var len=$(".pscroll").length;
	var degree = 360/len;
	var halfdeg=degree/2;
	zdegree=420/(Math.tan(2*Math.PI/360*halfdeg));
	$(".pscroll").each(function(i){
		$(this).css(kernel+"transform","rotateY("+(degree*i)+"deg) translateZ("+zdegree+"px)");
		$(this).append((i+1)+"/"+len)
	});
	var n=0,to=1;
	function moveimg(to){
		n=to=='left'?n+degree:n-degree;
		$(".win section.pscroll").each(function(i){
			$(this).css(kernel+"transform","rotateY("+(degree*i+n)+"deg) translateZ("+zdegree+"px)");
		});
		/*
		var cValue = 0;
		var oldDegree = $(".win").attr("style");
		var degf = oldDegree.indexOf("rotateY(");
		var dege = oldDegree.indexOf("deg");
		if(degf!=-1 && dege!=-1){
			cValue = oldDegree.substring(degf+8,dege);
		}
		$(".win").css(kernel+"transform","rotateY("+(Number(cValue) + degree)+"deg)");
		*/
	}
	function touchSatrtFunc(evt) {
		window.start=true;
		var ex = evt || window.event;
		var target = ex.target || ex.srcElement;
		if(target.id==="register"){
			window.location.href = registerUrl;
		}
		stopDefault(ex);
		try{
			var x = getXY(ex).x;
			startX = x;
		}catch (e) {}
	}
	function touchMoveFunc(evt) {
		if(!window.start) return;
		var ex = evt || window.event;
		stopDefault(ex);
		try{
			var x = getXY(ex).x;
			if(Math.abs(x-startX)>20){//防止误操作，参数100可调
				 if(x-startX>0){
				  	to=1;
				  }else{
				  	to=0;
				  }
				window.start=false;
			}
		}catch (e) {}
	}
	function getXY(e) {
		var x=0,y=0;
		if (isM) {
			var touch = e.touches[0];
			x = touch.clientX;
			y = touch.clientY;
		}
		else {
			x = e.pageX;
			y = e.pageY;
		}
		return {"x":x,"y":y};
	}
	function touchEndFunc(evt) {
		if(window.start) return;
		var ex = evt || window.event;
		stopDefault(ex);
		try {
			to?moveimg('left'):moveimg('right');
			$("#car_audio")[0].play();
		}catch (e) {}
		window.start=true;	
	}
	function stopDefault(e){
		e.preventDefault();
		e.stopPropagation();
	}
	var addevent=function(){
		E(touchSatrtFunc,START,win);
		E(touchMoveFunc,MOVE,win);
		E(touchEndFunc,END,win);
	}
	E(stopDefault,START);
	E(stopDefault,MOVE);
	E(stopDefault,END);
	addevent();
});

	var audio_switch_btn= true;			//声音开关控制值
	/*
	** 声音功能的控制
	*/
	var audio_switch_btn= true,			//声音开关控制值
	audio_btn		= true,			//声音播放完毕
	audio_loop		= false,		//声音循环
	audioTime		= null,         //声音播放延时
	audioTimeT		= null,			//记录上次播放时间
	audio_interval	= null,			//声音循环控制器
	audio_start		= null,			//声音加载完毕
	audio_stop		= null,			//声音是否在停止
	mousedown		= null;			//PC鼠标控制鼠标按下获取值

	function audio_close(){
		if(audio_btn&&audio_loop){
			audio_btn =false;
			audioTime = Number($("#car_audio")[0].duration-$("#car_audio")[0].currentTime)*1000;	
			if(audioTime<0){ audioTime=0; }
			if(audio_start){
				if(isNaN(audioTime)){
					audioTime = audioTimeT;
				}else{
					audioTime > audioTimeT ? audioTime = audioTime: audioTime = audioTimeT;
				}
			};
			if(!isNaN(audioTime)&&audioTime!=0){
				audio_btn =false;		
				setTimeout(
					function(){	
						$("#car_audio")[0].pause();
						$("#car_audio")[0].currentTime = 0;
						audio_btn = true;
						audio_start = true;	
						if(!isNaN(audioTime)&&audioTime>audioTimeT) audioTimeT = audioTime;
					},audioTime);
			}else{
				audio_interval = setInterval(function(){
					if(!isNaN($("#car_audio")[0].duration)){
						if($("#car_audio")[0].currentTime !=0 && $("#car_audio")[0].duration!=0 && $("#car_audio")[0].duration==$("#car_audio")[0].currentTime){
							$("#car_audio")[0].currentTime = 0;	
							$("#car_audio")[0].pause();
							clearInterval(audio_interval);
							audio_btn = true;
							audio_start = true;
							if(!isNaN(audioTime)&&audioTime>audioTimeT) audioTimeT = audioTime;
						}
					}
				},20)	
			}
		}
	}


	$(function(){
		//获取声音元件
		var btn_au = $(".fn-audio").find(".btn");

		//绑定点击事件
		btn_au.on('click',audio_switch);
		function audio_switch(){
			if($("#car_audio")==undefined){
				return;
			}
			if(audio_switch_btn){
				//关闭声音
				$("#car_audio")[0].pause();
				audio_switch_btn = false;
				//$("#car_audio")[0].currentTime = 0;
				btn_au.find("span").eq(0).css("display","none");
				btn_au.find("span").eq(1).css("display","inline-block");
			}
			//开启声音
			else{
				audio_switch_btn = true;
				btn_au.find("span").eq(1).css("display","none");
				btn_au.find("span").eq(0).css("display","inline-block");
			}
		}
	});

</script>

