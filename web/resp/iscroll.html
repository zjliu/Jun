<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>iScroll demo: simple</title>
<script type="text/javascript" src="iscroll.js"></script>
<script type="text/javascript">
var myScroll;
function loaded() {
	myScroll = new iScroll('pics_list');
}
document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
document.addEventListener('DOMContentLoaded', function () { setTimeout(loaded, 200); }, false);
</script>

<style type="text/css" media="all">
body,ul,li {
	padding:0;
	margin:0;
	border:0;
}

body {
	font-size:12px;
	-webkit-user-select:none;
    -webkit-text-size-adjust:none;
	font-family:helvetica;
}

#footer {
	position:absolute; z-index:2;
	bottom:0; left:0;
	width:100%;
	height:48px;
	background-color:#222;
	background-image:-webkit-gradient(linear, 0 0, 0 100%, color-stop(0, #999), color-stop(0.02, #666), color-stop(1, #222));
	background-image:-moz-linear-gradient(top, #999, #666 2%, #222);
	background-image:-o-linear-gradient(top, #999, #666 2%, #222);
	padding:0;
	border-top:1px solid #444;
}

#pics_list {
	position:absolute; z-index:1;
	top:45px; bottom:48px; left:0;
	width:100%;
	background:rgba(244,244,244,1);
	overflow:auto;
}

#scroller {
	position:absolute; z-index:1;
	-webkit-tap-highlight-color:rgba(0,0,0,0);
	width:100%;
	padding:0;
}

#scroller ul {
	list-style:none;
	padding:0;
	margin:0;
	width:100%;
	text-align:left;
}

#scroller li {
	margin:10px 0 0px 10px;
	height:90px;
	width:90px;
	float:left;
	line-height:40px;
	border-bottom:1px solid #ccc;
	border-top:1px solid #fff;
	background-color:#fafafa;
	font-size:16px;
}

.picsDiv .pics_nav{width:100%;height:50px;position:relative;color:rgb(221,102,0);background-color:rgb(255,255,255);border-bottom:solid 1px rgb(230,230,230);
	background-image:-webkit-gradient(linear, 0 0, 0 100%, color-stop(0, #000000), color-stop(0.05, #dddddd), color-stop(1, rgba(255,255,255,1)));
	background-image:-moz-linear-gradient(top, #000000, #dddddd 5%, #ffffff);
	background-image:-o-linear-gradient(top,#000000, #dddddd 5%, #ffffff);
	font-size:16px;
}
.picsDiv .pics_nav .pics_title{position:absolute;top:0;width:100%;height:50px;line-height:50px;color:black;text-align:center;}
.picsDiv .pics_nav .pics_cmd{cursor:pointer;}
.picsDiv .pics_nav .pics_cmd a{display:inline-block;width:80px;height:50px;line-height:50px;text-align:center;}
.picsDiv .pics_nav .pics_cmd .pics_cmd_left{float:left;}
.picsDiv .pics_nav .pics_cmd .pics_cmd_right{float:right;width:40px;}

</style>
</head>
<body>
<div class="picsDiv">
	<div class="pics_nav">
		<div class="pics_title">图片列表</div>
		<div class="pics_cmd">
			<a class="pics_cmd_left">我的素材</a>
			<a class="pics_cmd_right"><img style="margin-top:17px;" src="log.png" /></a>
			<a class="pics_cmd_right"><img style="margin-top:16px;" src="ok.png" /></a>
			<a class="pics_cmd_right"><img style="margin-top:10px;" src="del.png" /></a>
		</div>
	</div>
	<div id="pics_list">
		<div id="scroller">
			<ul id="thelist">
				<li>Pretty row 1</li>
				<li>Pretty row 2</li>
				<li>Pretty row 3</li>
				<li>Pretty row 4</li>
				<li>Pretty row 5</li>
				<li>Pretty row 6</li>
				<li>Pretty row 7</li>
				<li>Pretty row 8</li>
				<li>Pretty row 9</li>
				<li>Pretty row 10</li>
				<li>Pretty row 11</li>
				<li>Pretty row 12</li>
				<li>Pretty row 13</li>
				<li>Pretty row 14</li>
				<li>Pretty row 15</li>
				<li>Pretty row 16</li>
				<li>Pretty row 17</li>
				<li>Pretty row 18</li>
				<li>Pretty row 19</li>
				<li>Pretty row 20</li>
				<li>Pretty row 21</li>
				<li>Pretty row 22</li>
				<li>Pretty row 23</li>
				<li>Pretty row 24</li>
				<li>Pretty row 25</li>
				<li>Pretty row 26</li>
				<li>Pretty row 27</li>
				<li>Pretty row 28</li>
				<li>Pretty row 29</li>
				<li>Pretty row 30</li>
				<li>Pretty row 31</li>
				<li>Pretty row 32</li>
				<li>Pretty row 33</li>
				<li>Pretty row 34</li>
				<li>Pretty row 35</li>
				<li>Pretty row 36</li>
				<li>Pretty row 37</li>
				<li>Pretty row 38</li>
				<li>Pretty row 39</li>
				<li>Pretty row 40</li>
			</ul>
		</div>
	</div>
</div>
<div id="footer"></div>
</body>
</html>
<script>
	function E(f, e, o) {
		if (!e) e = 'load';
		if (!o) o = window;
		if (o.attachEvent) {
			o.attachEvent('on' + e, f)
		} else {
			o.addEventListener(e, f, false)
		}
	}

	function stopDefault(e){
		e.preventDefault();
		e.stopPropagation();
	}

	var listEl = document.getElementById("scroller");

	listEl.onclick=function(e){
		var ex = e || window.event;
		var target = ex.target || ex.srcElement;
		if(target.tagName.toLowerCase()==="img"){
			var aEl = target.parentNode;
			aEl.classList.toggle("on");
			if(aEl.children.length===1){
				var span = document.createElement("span");
				span.classList.add("marker");
				aEl.appendChild(span);
			}
			else{
				aEl.removeChild(aEl.lastChild);
			}
		}
	}

	var resizeImg=function(img){
		if(!img) return;
		var parent = img.parentNode;
		var w = parseInt(getComputedStyle(parent)["width"])
		var h = parseInt(getComputedStyle(parent)["height"])
		var iw=img.width;
		var ih=img.height;
		var newW=w;
		var newH=h;
		if (iw > w || ih > h) {
			if (iw / ih > w / h){
				img.width = w;
				newW = w;
				newH = w * (ih / iw);
				img.height = newH;
				}else {
				img.height = h;
				newH = h;
				newW = h / (ih / iw);
				img.width = newW;
			}
		}	
		img.style.marginTop = (h - newH)/2 + "px";
		img.style.marginLeft = (w - newW)/2 + "px";
	}

	var arr=["http://img0.bdstatic.com/img/image/shouye/meinv.jpg","http://img0.bdstatic.com/img/image/shouye/xiezhen1.jpg","http://img0.bdstatic.com/img/image/fushi/kaishan.jpg"];
	var ulEl = listEl.firstElementChild;
	arr = arr.concat(arr);
	arr = arr.concat(arr);
	arr = arr.concat(arr);
	
	var loadImg=function(url,pli,index){
		var img = new Image();
		img.onload=function(e){
			pli.removeChild(pli.firstChild);
			pli.appendChild(img);
			resizeImg(img);
			if(index<arr.length-1)
				addNext(++index);	
			else{
				bindScroll();		
			}
		}
		img.src=url;
	}


	function addNext(index){
		var item = arr[index];
		var li = document.createElement("li");
		li.innerHTML='<a><img class="refresh" src="refresh.gif" /></a><b></b>';
		ulEl.appendChild(li);
		loadImg(item,li.firstChild,index);
	}

	addNext(0);

</script>
